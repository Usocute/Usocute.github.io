{
    "version": "https://jsonfeed.org/version/1",
    "title": "脆弱星球 • All posts by \"数据库\" tag",
    "description": "立于皓月之边,不弱星光之势",
    "home_page_url": "https://eliauk.cc",
    "items": [
        {
            "id": "https://eliauk.cc/post/f5a946ac.html",
            "url": "https://eliauk.cc/post/f5a946ac.html",
            "title": "MySQL 视图与索引",
            "date_published": "2020-09-24T07:50:11.000Z",
            "content_html": "<h2>视图</h2> \n### 基本概念\n视图本身是一张虚拟表，不存放任何数据。在使用SQL语句访问视图的时候，获取的数据是MySQL从其它表中生成的，视图和表在同一个命名空间。视图查询数据相对安全，视图可以隐藏一些数据和结构，只让用户看见权限内的数据，使复杂的查询易于理解和使用。\n<h3 id=\"视图用法\"><a class=\"markdownIt-Anchor\" href=\"#视图用法\">#</a> 视图用法</h3>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#### 基本语法</span></span><br><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">OR</span> <span class=\"keyword\">REPLACE</span> <span class=\"keyword\">VIEW</span> view_name </span><br><span class=\"line\"><span class=\"keyword\">AS</span> select_statement</span><br></pre></td></tr></table></figure>\n<p><strong>注意事项：表和视图共享数据库中相同的名称空间，因此，数据库不能包含具有相同名称的表和视图。</strong></p>\n<h4 id=\"视图调用\"><a class=\"markdownIt-Anchor\" href=\"#视图调用\">#</a> 视图调用</h4>\n<p><strong>和 MySQL 的表查询基本一致，可以使用各种查询条件。</strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> * <span class=\"keyword\">FROM</span> user_order_view <span class=\"keyword\">WHERE</span> user_name=<span class=\"string\">&#x27;Cicada&#x27;</span>;</span><br></pre></td></tr></table></figure>\n<h4 id=\"查看视图\"><a class=\"markdownIt-Anchor\" href=\"#查看视图\">#</a> 查看视图</h4>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SHOW</span> <span class=\"keyword\">CREATE</span> <span class=\"keyword\">VIEW</span> user_order_view ;</span><br></pre></td></tr></table></figure>\n<h4 id=\"修改视图\"><a class=\"markdownIt-Anchor\" href=\"#修改视图\">#</a> 修改视图</h4>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">ALTER</span> <span class=\"keyword\">VIEW</span> view_name <span class=\"keyword\">AS</span> select_statement ;</span><br></pre></td></tr></table></figure>\n<h4 id=\"删除视图\"><a class=\"markdownIt-Anchor\" href=\"#删除视图\">#</a> 删除视图</h4>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">DROP</span> <span class=\"keyword\">VIEW</span> [<span class=\"keyword\">IF</span> <span class=\"keyword\">EXISTS</span>] view_name ;</span><br></pre></td></tr></table></figure>\n<h3 id=\"视图更新\"><a class=\"markdownIt-Anchor\" href=\"#视图更新\">#</a> 视图更新</h3>\n<p>** 在指定条件允许的情况下，可以通过在视图上操作更新，删除，甚至写入数据，进而更新视图所涉及的相关表。</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">UPDATE</span> user_order_view <span class=\"keyword\">SET</span> user_name=<span class=\"string\">&#x27;smile&#x27;</span> <span class=\"keyword\">WHERE</span> <span class=\"keyword\">id</span>=<span class=\"string\">&#x27;1&#x27;</span>;</span><br></pre></td></tr></table></figure>\n<ul class=\"task-list\">\n<li class=\"task-list-item\">\n<p><input type=\"checkbox\" id=\"cbx_0\" checked=\"true\" disabled=\"true\"><label for=\"cbx_0\"> 如果视图定义时使用聚合函数，分组等特殊操作，则无法更新。</label></p>\n</li>\n<li class=\"task-list-item\">\n<p><input type=\"checkbox\" id=\"cbx_1\" checked=\"true\" disabled=\"true\"><label for=\"cbx_1\"> MySQL 不支持在视图上创建触发器。</label></p>\n</li>\n</ul>\n<h3 id=\"注意事项\"><a class=\"markdownIt-Anchor\" href=\"#注意事项\">#</a> 注意事项</h3>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_2\" checked=\"true\" disabled=\"true\"><label for=\"cbx_2\"> MySQL 并不支持在视图中创建索引，使用视图的时候可能会引发很多查询性能问题</label></li>\n</ul>\n<h2 id=\"索引\"><a class=\"markdownIt-Anchor\" href=\"#索引\">#</a> 索引</h2>\n<h3 id=\"索引的优缺点\"><a class=\"markdownIt-Anchor\" href=\"#索引的优缺点\">#</a> 索引的优缺点</h3>\n<h4 id=\"优点\"><a class=\"markdownIt-Anchor\" href=\"#优点\">#</a> 优点</h4>\n<ul>\n<li>索引大大减小了服务器需要扫描的数据量</li>\n<li>索引可以帮助服务器避免排序和临时表</li>\n<li>索引对于 InnoDB（对索引支持行级锁）非常重要，因为它可以让查询锁更少的元组。</li>\n</ul>\n<h4 id=\"缺点\"><a class=\"markdownIt-Anchor\" href=\"#缺点\">#</a> 缺点</h4>\n<ul>\n<li>虽然索引大大提高了查询速度，同时却会降低更新表的速度，如对表进行 INSERT、UPDATE 和 DELETE。因为更新表时，MySQL 不仅要保存数据，还要保存索引文件。</li>\n<li>建立索引会占用磁盘空间的索引文件。</li>\n<li>如果某个数据列包含许多重复的内容，为它建立索引就没有太大的实际效果。</li>\n<li>对于非常小的表，大部分情况下简单的全表扫描更高效；</li>\n</ul>\n<h3 id=\"索引创建语法\"><a class=\"markdownIt-Anchor\" href=\"#索引创建语法\">#</a> 索引创建语法</h3>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- 普通索引</span></span><br><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">index</span> index1 <span class=\"keyword\">on</span> student (<span class=\"keyword\">id</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 唯一索引</span></span><br><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">UNIQUE</span> <span class=\"keyword\">INDEX</span> index2 <span class=\"keyword\">on</span> student(<span class=\"keyword\">id</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 全文索引</span></span><br><span class=\"line\"><span class=\"keyword\">CREATE</span> FULLTEXT <span class=\"keyword\">INDEX</span> index3 <span class=\"keyword\">on</span> student(adress(<span class=\"number\">20</span>));</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 创建单列索引</span></span><br><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">INDEX</span> INDEX5 <span class=\"keyword\">on</span> student(<span class=\"keyword\">name</span>(<span class=\"number\">10</span>));</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 联合索引</span></span><br><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">INDEX</span> INDEX6 <span class=\"keyword\">ON</span> student (<span class=\"keyword\">name</span>,<span class=\"keyword\">id</span>); </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 普通索引</span></span><br><span class=\"line\"><span class=\"keyword\">ALTER</span> <span class=\"keyword\">TABLE</span> student <span class=\"keyword\">ADD</span> <span class=\"keyword\">INDEX</span> index1(<span class=\"keyword\">id</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 唯一索引</span></span><br><span class=\"line\"><span class=\"keyword\">ALTER</span> <span class=\"keyword\">TABLE</span> student <span class=\"keyword\">ADD</span> <span class=\"keyword\">UNIQUE</span> <span class=\"keyword\">INDEX</span> index2(<span class=\"keyword\">id</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 全文索引</span></span><br><span class=\"line\"><span class=\"keyword\">ALTER</span> <span class=\"keyword\">TABLE</span> student <span class=\"keyword\">add</span> FULLTEXT <span class=\"keyword\">INDEX</span> index3 (<span class=\"keyword\">NAME</span>(<span class=\"number\">20</span>));</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 单列索引</span></span><br><span class=\"line\"><span class=\"keyword\">ALTER</span> <span class=\"keyword\">TABLE</span> student <span class=\"keyword\">ADD</span> <span class=\"keyword\">INDEX</span> index4 (adress(<span class=\"number\">20</span>));</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 联合索引</span></span><br><span class=\"line\"><span class=\"keyword\">ALTER</span> <span class=\"keyword\">TABLE</span> student <span class=\"keyword\">ADD</span> <span class=\"keyword\">INDEX</span> INDEX5 (<span class=\"keyword\">name</span>,<span class=\"keyword\">id</span>);</span><br></pre></td></tr></table></figure>",
            "tags": [
                "MySQL",
                "数据库",
                "View",
                "index"
            ]
        },
        {
            "id": "https://eliauk.cc/post/47c80ad2.html",
            "url": "https://eliauk.cc/post/47c80ad2.html",
            "title": "MySQL 存储过程事务处理",
            "date_published": "2020-09-19T02:24:11.000Z",
            "content_html": "<h2 id=\"存储过程\"><a class=\"markdownIt-Anchor\" href=\"#存储过程\">#</a> 存储过程</h2>\n<h3 id=\"简介\"><a class=\"markdownIt-Anchor\" href=\"#简介\">#</a> 简介</h3>\n<p>存储程序是被存储在服务器中的组合 SQL 语句，经编译创建并保存在数据库中，用户可通过存储过程的名字调用执行。存储过程核心思想就是数据库 SQL 语言层面的封装与重用性。使用存储过程可以较少应用系统的业务复杂性，但是会增加数据库服务器系统的负荷。</p>\n<h3 id=\"基本语法\"><a class=\"markdownIt-Anchor\" href=\"#基本语法\">#</a> 基本语法</h3>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">PROCEDURE</span> sp_name ([proc_parameter[,...]])</span><br><span class=\"line\">    [characteristic ...] routine_body</span><br></pre></td></tr></table></figure>\n<h3 id=\"案例\"><a class=\"markdownIt-Anchor\" href=\"#案例\">#</a> 案例</h3>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- 查询学生表中性别为男的学生总数</span></span><br><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">PROCEDURE</span> u_pro(<span class=\"keyword\">IN</span> v_sex <span class=\"built_in\">VARCHAR</span>(<span class=\"number\">5</span>) <span class=\"built_in\">CHARACTER</span> <span class=\"keyword\">SET</span> utf8 ,<span class=\"keyword\">OUT</span> <span class=\"keyword\">num</span> <span class=\"built_in\">INT</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">BEGIN</span></span><br><span class=\"line\">\t<span class=\"keyword\">SELECT</span> <span class=\"keyword\">COUNT</span>(*) <span class=\"keyword\">INTO</span> <span class=\"keyword\">num</span> <span class=\"keyword\">FROM</span> student <span class=\"keyword\">WHERE</span> v_sex=sex;</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">CALL</span> u_pro(<span class=\"string\">&#x27;男&#x27;</span>,@<span class=\"keyword\">num</span>);</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> @<span class=\"keyword\">num</span>;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- 计算1+到n的值</span></span><br><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">PROCEDURE</span> addresult(<span class=\"keyword\">IN</span> n <span class=\"built_in\">INT</span>)</span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span></span><br><span class=\"line\">\t<span class=\"keyword\">DECLARE</span> i <span class=\"built_in\">INT</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">DECLARE</span> <span class=\"keyword\">sum</span> <span class=\"built_in\">INT</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">SET</span> <span class=\"keyword\">sum</span> =<span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">SET</span> i =<span class=\"number\">1</span>;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tWHILE i&lt;n DO</span><br><span class=\"line\">\t<span class=\"keyword\">SET</span> <span class=\"keyword\">sum</span>=<span class=\"keyword\">sum</span>+i;</span><br><span class=\"line\">\t<span class=\"keyword\">SET</span> i=i+<span class=\"number\">1</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">END</span> <span class=\"keyword\">WHILE</span>;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">SELECT</span> <span class=\"keyword\">sum</span> ;</span><br><span class=\"line\"><span class=\"keyword\">END</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">call</span> addresult(<span class=\"number\">50</span>);</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- 计算1+到n的值</span></span><br><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">PROCEDURE</span> addresult2(<span class=\"keyword\">in</span> n <span class=\"built_in\">INT</span>,<span class=\"keyword\">out</span> <span class=\"keyword\">sum</span> <span class=\"built_in\">INT</span>)</span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span></span><br><span class=\"line\">\t<span class=\"keyword\">DECLARE</span> i <span class=\"built_in\">INT</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">DECLARE</span> <span class=\"keyword\">sum</span> <span class=\"built_in\">INT</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">SET</span> <span class=\"keyword\">sum</span> =<span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">SET</span> i =<span class=\"number\">1</span>;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tWHILE i&lt;n DO</span><br><span class=\"line\">\t<span class=\"keyword\">SET</span> <span class=\"keyword\">sum</span>=<span class=\"keyword\">sum</span>+i;</span><br><span class=\"line\">\t<span class=\"keyword\">SET</span> i=i+<span class=\"number\">1</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">END</span> <span class=\"keyword\">WHILE</span>;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">SELECT</span> <span class=\"keyword\">sum</span> ;</span><br><span class=\"line\"><span class=\"keyword\">END</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">call</span> addresult2(<span class=\"number\">50</span>,@<span class=\"keyword\">sum</span>);</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- 判断变量</span></span><br><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">PROCEDURE</span> user_main_pro3(INOUT v_id <span class=\"built_in\">INT</span>)</span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span></span><br><span class=\"line\">  <span class=\"comment\"># 定义变量</span></span><br><span class=\"line\">  <span class=\"keyword\">DECLARE</span> v_count <span class=\"built_in\">INT</span>(<span class=\"number\">11</span>);</span><br><span class=\"line\">  <span class=\"comment\"># 判断</span></span><br><span class=\"line\">  IF v_id &gt; 3 THEN</span><br><span class=\"line\">     <span class=\"keyword\">SET</span> v_count = <span class=\"number\">100</span>;</span><br><span class=\"line\">  ELSE </span><br><span class=\"line\">     <span class=\"keyword\">SET</span> v_count = <span class=\"number\">500</span>;</span><br><span class=\"line\">  <span class=\"keyword\">END</span> <span class=\"keyword\">IF</span>;</span><br><span class=\"line\">  <span class=\"comment\"># 返回赋值</span></span><br><span class=\"line\">  <span class=\"keyword\">SET</span> v_id = v_count;</span><br><span class=\"line\"><span class=\"keyword\">END</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">SET</span> @v_id=<span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"keyword\">call</span> user_main_pro3(@v_id);</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> @v_id;</span><br></pre></td></tr></table></figure>\n<h2 id=\"事务处理\"><a class=\"markdownIt-Anchor\" href=\"#事务处理\">#</a> 事务处理</h2>\n<h3 id=\"注意点\"><a class=\"markdownIt-Anchor\" href=\"#注意点\">#</a> 注意点</h3>\n<p><strong>MySQL 中 Innodb 支持事务，而 MyISAM 不支持事务</strong></p>\n<h3 id=\"事务的特性\"><a class=\"markdownIt-Anchor\" href=\"#事务的特性\">#</a> 事务的特性：</h3>\n<ul>\n<li>原子性（Atomicity）：事务开始后的所有操作，要么全部做完，要么全部不做。事务执行过程中出错，会回滚到事务开始前的状态，所有的操作就像没有发生一样。</li>\n<li>一致性（Consistency）：事务开始前和结束后，数据库的完整性约束没有被破坏 。比如 A 向 B 转账，不可能 A 扣了钱，B 却没收到。</li>\n<li>隔离性（Isolation）：同一时间，只允许一个事务请求同一数据，不同的事务之间彼此没有任何干扰。比如 A 正在从一张银行卡中取钱，在 A 取钱的过程结束前，B 不能向这张卡转账。</li>\n<li>持久性（Durability）：事务完成后，事务对数据库的所有更新将被保存到数据库，不能回滚。</li>\n</ul>\n<h3 id=\"并发问题\"><a class=\"markdownIt-Anchor\" href=\"#并发问题\">#</a> 并发问题</h3>\n<ul>\n<li>\n<p>脏读：事务 A 读取了事务 B 更新的数据，然后 B 回滚操作，那么 A 读取到的数据是脏数据</p>\n</li>\n<li>\n<p>不可重复读：事务 A 多次读取同一数据，事务 B 在事务 A 多次读取的过程中，对数据作了更新并提交，导致事务 A 多次读取同一数据时，结果 不一致。</p>\n</li>\n<li>\n<p>幻读：系统管理员 A 将数据库中所有学生的成绩从具体分数改为 ABCDE 等级，但是系统管理员 B 就在这个时候插入了一条具体分数的记录，当系统管理员 A 改结束后发现还有一条记录没有改过来，就好像发生了幻觉一样，这时就叫幻读。</p>\n</li>\n</ul>\n<p><strong>注：不可重复读的和幻读很容易混淆，不可重复读侧重于修改，幻读侧重于新增或删除。解决不可重复读的问题只需锁住满足条件的行，解决幻读需要锁表</strong></p>\n<h3 id=\"事务隔离级别\"><a class=\"markdownIt-Anchor\" href=\"#事务隔离级别\">#</a> 事务隔离级别</h3>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">事务隔离级别</th>\n<th style=\"text-align:right\">脏读</th>\n<th style=\"text-align:center\">不可重复读</th>\n<th style=\"text-align:center\">幻读</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">读未提交（read-uncommitted）</td>\n<td style=\"text-align:right\">是</td>\n<td style=\"text-align:center\">是</td>\n<td style=\"text-align:center\">是</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">不可重复读（read-committed）</td>\n<td style=\"text-align:right\">否</td>\n<td style=\"text-align:center\">是</td>\n<td style=\"text-align:center\">是</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">可重复读（repeatable-read）</td>\n<td style=\"text-align:right\">否</td>\n<td style=\"text-align:center\">否</td>\n<td style=\"text-align:center\">是</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">串行化（serializable）</td>\n<td style=\"text-align:right\">否</td>\n<td style=\"text-align:center\">否</td>\n<td style=\"text-align:center\">否</td>\n</tr>\n</tbody>\n</table>\n<p><strong>设置隔离级别：</strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SET</span> <span class=\"keyword\">SESSION</span> <span class=\"keyword\">TRANSACTION</span> <span class=\"keyword\">ISOLATION</span> <span class=\"keyword\">LEVEL</span> <span class=\"keyword\">READ</span> UNCOMMITTED;</span><br></pre></td></tr></table></figure>\n<p>只有增删改语句才支持事务</p>\n",
            "tags": [
                "MySQL",
                "数据库",
                "存储过程",
                "视图"
            ]
        },
        {
            "id": "https://eliauk.cc/post/89bbd8d4.html",
            "url": "https://eliauk.cc/post/89bbd8d4.html",
            "title": "MySQL 查询",
            "date_published": "2020-09-14T11:04:03.000Z",
            "content_html": "<h2 id=\"连接查询\"><a class=\"markdownIt-Anchor\" href=\"#连接查询\">#</a> 连接查询</h2>\n<p><strong>在数据库中 join 操作被称为连接，作用是能连接多个表的数据（通过连接条件），从多个表中获取数据合并在一起作为结果集返回给客户端。</strong></p>\n<h3 id=\"交叉连接\"><a class=\"markdownIt-Anchor\" href=\"#交叉连接\">#</a> 交叉连接</h3>\n<p><strong>交叉连接：将两张表的数据与另外一张表彼此交叉</strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> * <span class=\"keyword\">from</span> 表<span class=\"number\">1</span> <span class=\"keyword\">cross</span> <span class=\"keyword\">join</span> 表<span class=\"number\">2</span></span><br><span class=\"line\">eg：</span><br><span class=\"line\"><span class=\"keyword\">select</span> class.cname, student.sname <span class=\"keyword\">from</span> student <span class=\"keyword\">cross</span> <span class=\"keyword\">join</span> <span class=\"keyword\">class</span> <span class=\"keyword\">on</span> class.cid =</span><br><span class=\"line\">student.classid;</span><br><span class=\"line\"><span class=\"comment\">--其中的on代表两个表的连接条件</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"内连接\"><a class=\"markdownIt-Anchor\" href=\"#内连接\">#</a> 内连接</h3>\n<p><img src=\"https://usocute.oss-cn-chengdu.aliyuncs.com/hexo/inner-join.png\" alt=\"inner-join\"></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">方式一：</span><br><span class=\"line\"><span class=\"keyword\">select</span> * <span class=\"keyword\">from</span> 表<span class=\"number\">1</span>,表<span class=\"number\">2</span> <span class=\"keyword\">where</span> 表<span class=\"number\">1.</span>列=表<span class=\"number\">2.</span>列</span><br><span class=\"line\">方式二：</span><br><span class=\"line\"><span class=\"keyword\">select</span> * <span class=\"keyword\">from</span> 表<span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">inner</span> <span class=\"keyword\">join</span> 表<span class=\"number\">2</span> <span class=\"keyword\">on</span> 表<span class=\"number\">1.</span>列=表<span class=\"number\">2.</span>列</span><br></pre></td></tr></table></figure>\n<h3 id=\"外连接\"><a class=\"markdownIt-Anchor\" href=\"#外连接\">#</a> 外连接</h3>\n<h4 id=\"左连接\"><a class=\"markdownIt-Anchor\" href=\"#左连接\">#</a> 左连接</h4>\n<p>左连接基础语法是  <code>a left outer join b </code> ，其中的  <code>outer</code>  可以省略，与内连接相比就是在与内连接相<br>\n同条件下，在内连接的结果集中添加 <code>a</code>  表在 <code>b</code>  表中找不到匹配的记录，换句话说就是，结果集中会包含 <code>a</code>  表中的所有记录，如果 <code>b</code>  表中有匹配的记录就出现在结果集，否则使用  <code>NULL</code>  代替，也就是把 <code>a</code>  表看成根本，不可缺失记录。<br>\n<img src=\"https://usocute.oss-cn-chengdu.aliyuncs.com/hexo/left-join.png\" alt=\"left-join\"></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> * <span class=\"keyword\">from</span> 表<span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">left</span> <span class=\"keyword\">join</span> 表<span class=\"number\">2</span> <span class=\"keyword\">on</span> 表<span class=\"number\">1.</span>列=表<span class=\"number\">2.</span>列</span><br></pre></td></tr></table></figure>\n<h4 id=\"右连接\"><a class=\"markdownIt-Anchor\" href=\"#右连接\">#</a> 右连接</h4>\n<p>右外连接基础语法是  <code>a right outer join b </code> ，其中的  <code>outer</code>  可以省略，与内连接相比就是在与内连<br>\n接相同条件下，在内连接的结果集中添加 b 表在 a 表中找不到匹配的记录，换句话说就是，结果集中会包含 b 表中的所有记录，如果 a 表中有匹配的记录就出现在结果集，否则使用 NULL 代替，也就是把 b 表看成根本，不可缺失记录，作用与左外连接恰好相反。<br>\n<img src=\"https://usocute.oss-cn-chengdu.aliyuncs.com/hexo/right-join.png\" alt=\"right-join\"></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> * <span class=\"keyword\">from</span> 表<span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">right</span> <span class=\"keyword\">join</span> 表<span class=\"number\">2</span> <span class=\"keyword\">on</span> 表<span class=\"number\">1.</span>列=表<span class=\"number\">2.</span>列</span><br></pre></td></tr></table></figure>\n<h3 id=\"自连接\"><a class=\"markdownIt-Anchor\" href=\"#自连接\">#</a> 自连接</h3>\n<p>自连接就是表与它自身相关联，进行自连接时通过给表起不同的别名来区分一个表的两个实例。</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> 表.字段<span class=\"number\">1</span>,表.字段<span class=\"number\">2</span>,表.字段<span class=\"number\">3</span> </span><br><span class=\"line\"><span class=\"keyword\">from</span> 表<span class=\"number\">1</span> <span class=\"keyword\">as</span> 别名,表<span class=\"number\">2</span> <span class=\"keyword\">as</span> 别名 </span><br><span class=\"line\"><span class=\"keyword\">where</span> 别名.字段<span class=\"number\">2</span>=别名<span class=\"number\">2.</span>字段<span class=\"number\">3</span>；</span><br></pre></td></tr></table></figure>\n<h2 id=\"子查询\"><a class=\"markdownIt-Anchor\" href=\"#子查询\">#</a> 子查询</h2>\n<p>子查询指嵌套在查询内部，且必须始终出现在圆括号。子查询可以包含多个关键字或条件，如<br>\n <code>DISTINCT</code> 、 <code>GROUP BY</code> 、 <code>ORDER BY</code> 、 <code>LIMIT</code> 、 <code>函数</code> 等。<br>\n子查询的外层查询可以是： <code>SELECT</code> ， <code>INSERT</code> ， <code>UPDATE</code> ， <code>SET或DO</code> 。<br>\n子查询可以返回标量，一行，一列或子查询。</p>\n<h3 id=\"将子查询作为派生表\"><a class=\"markdownIt-Anchor\" href=\"#将子查询作为派生表\">#</a> 将子查询作为派生表</h3>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> * <span class=\"keyword\">from</span> 表<span class=\"number\">1</span> <span class=\"keyword\">where</span> 字段<span class=\"number\">1</span> = （<span class=\"keyword\">select</span> 字段<span class=\"number\">2</span> <span class=\"keyword\">from</span> 表<span class=\"number\">2</span>）;</span><br></pre></td></tr></table></figure>\n<h3 id=\"把子查询用在where子句中\"><a class=\"markdownIt-Anchor\" href=\"#把子查询用在where子句中\">#</a> 把子查询用在 where 子句中</h3>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">eg：</span><br><span class=\"line\"><span class=\"keyword\">select</span> ename,sal <span class=\"keyword\">from</span> emp <span class=\"keyword\">where</span> sal&gt;(<span class=\"keyword\">select</span> <span class=\"keyword\">avg</span>(sal) <span class=\"keyword\">form</span> emp);</span><br></pre></td></tr></table></figure>\n<h3 id=\"在from语句中使用子查询\"><a class=\"markdownIt-Anchor\" href=\"#在from语句中使用子查询\">#</a> 在 from 语句中使用子查询</h3>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">eg：</span><br><span class=\"line\"><span class=\"keyword\">select</span> t.deptno,t.avgsal,s.grade</span><br><span class=\"line\"><span class=\"keyword\">from</span> (<span class=\"keyword\">select</span> deptno,<span class=\"keyword\">avg</span>(sal) <span class=\"keyword\">as</span> avgsal <span class=\"keyword\">from</span> emp <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> deptno) t</span><br><span class=\"line\"><span class=\"keyword\">join</span> salgrade s</span><br><span class=\"line\"><span class=\"keyword\">on</span> t.avgsal <span class=\"keyword\">between</span> s.losal <span class=\"keyword\">and</span> s.hisal;</span><br></pre></td></tr></table></figure>\n<h2 id=\"集合操作union\"><a class=\"markdownIt-Anchor\" href=\"#集合操作union\">#</a> 集合操作 (UNION)</h2>\n<p><strong>union  作用：合并查询结果集</strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Eg：</span><br><span class=\"line\"><span class=\"keyword\">select</span> ename,job <span class=\"keyword\">from</span> emp <span class=\"keyword\">where</span> job=<span class=\"string\">&#x27;manager&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">union</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> ename,job <span class=\"keyword\">from</span> emp <span class=\"keyword\">where</span> job=<span class=\"string\">&#x27;salesman&#x27;</span>;</span><br></pre></td></tr></table></figure>\n<p><strong>limit</strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">limit 起始下标，长度</span><br><span class=\"line\">如果起始下标没有指定，默认从0开始，0表示表中第一条记录。</span><br><span class=\"line\">Eg：</span><br><span class=\"line\"><span class=\"comment\">--按照工资降序排列取前5个</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> ename,sal <span class=\"keyword\">from</span> emp <span class=\"keyword\">order</span> <span class=\"keyword\">by</span> sal <span class=\"keyword\">desc</span> <span class=\"keyword\">limit</span> <span class=\"number\">5</span>;</span><br></pre></td></tr></table></figure>\n<p><strong>通用的分页 SQL (只适用于 mysql 数据库管理系统)</strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> t.* <span class=\"keyword\">from</span> t</span><br><span class=\"line\"><span class=\"keyword\">order</span> <span class=\"keyword\">by</span> t.x <span class=\"keyword\">desc</span>/<span class=\"keyword\">asc</span></span><br><span class=\"line\"><span class=\"keyword\">limit</span> (pageNo<span class=\"number\">-1</span>)*pageSize,pageSize;</span><br></pre></td></tr></table></figure>\n",
            "tags": [
                "MySQL",
                "数据库",
                "查询"
            ]
        }
    ]
}